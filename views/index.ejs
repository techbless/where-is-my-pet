<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>라온[LAON]</title>
    <script src=https://cdn.jsdelivr.net/npm/promise-polyfill@8.1/dist/polyfill.min.js></script>
    <script src=https://cdn.jsdelivr.net/npm/whatwg-fetch@3.0/dist/fetch.umd.min.js></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Sunflower:300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" href="/phone.png">

    <script type="text/javascript" src="/js/cookie.js"></script>
    <style>
        * {
            font-family: 'Sunflower', sans-serif;
        }
        html, body {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }
        #info-img {
            display: block;
            width: 100%;
            height: auto;
            max-height: 100%;
        }
        #info-comment {
            white-space: pre-wrap;       /* Since CSS 2.1 */
            white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            overflow: auto;
            width: 98%;
        }
        pre {
            font-size: 16px;
            font-family: 'Sunflower', sans-serif;
        }
        #if{
            padding: 0px;
            margin: 0px;
            width: 0px;
            height: 0px;
            border: 0px;
            display: none;
        }
        .loading {
            width: 100px;
            height: auto;
            position:absolute;
            top:50%; left:50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-md bg-dark navbar-dark">
    <a class="navbar-brand" href="#">라온[LAON]</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="markerSwitch('finding')">실종만 표시</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="markerSwitch('found')">발견만 표시</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="markerSwitch('all')">모두 표시</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="$('#howtouse').modal()">사용 설명</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="$('#search-modal').modal()">검색</a>
            </li>
        </ul>
    </div>
</nav>

<!--56px-->
<div id="map" style="width:100%; height: calc(100% - 56px); padding: 0; margin: 0;"></div>

<img class="loading" src="/img/loading.gif" alt="Loading...">

<!-- The Modal -->
<div class="modal fade" id="howtouse">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">사용법 및 안내</h4>
                <!--<button type="button" class="close" data-dismiss="modal">&times;</button>-->
            </div>

            <!-- Modal body -->
            <div class="modal-body">

                <br><h3>마커 추가</h3><br>
                <ul>
                    <li>위치 및 추가정보 등록방법</li>
                    <ol>
                        <li><strong style="color: blue;">잃어버리거나 발견한 위치를 클릭하여 주세요.</strong></li>
                        <li>마커 추가 창이 뜨면 사진을 선택한후 추가설명을 포함하여 모든 입력란을 채워주세요.</li>
                        <li>달력 아이콘을 눌러 날짜와 시간을 선택할 수 있습니다.</li>
                        <li>날짜를 선택한후 달력바로 밑 시계아이콘을 출력하여 꼭 시간도 선택해주세요.</li>
                        <li>실종과 발견 아이콘을 서로 다릅니다. 마커 유형을 알맞게 선택해주세요.</li>
                        <li>추가 버튼을 누른후, 삭제시에 이용할 비밀번호를 지정해주세요.</li>
                    </ol>
                </ul>

                <br><h3>특정 마커의 정보 조회</h3>
                <img style="margin-left: 55px;" src="/img/finding.png"><img src="/img/found.png">
                <ul>
                    <li>등록된 정보 조회방법</li>
                    <ol>
                        <li>물음표(?)가 그려진 빨간색 마커는 <span style="color: red;">잃어버린 위치 정보</span>를 의미합니다.</li>
                        <li>느낌표(!)가 그려진 초록색 마커는 <span style="color: green;">발견한 위치 정보</span>를 의미합니다.</li>
                        <li>지도에 표시된 마커를 눌러 자세한 정보를 확인하실 수 있습니다.</li>
                    </ol>
                </ul>

                <br><h3>마커 삭제</h3><br>
                <ul>
                    <li>특정 마커를 삭제하는 방법</li>
                    <ol>
                        <li>삭제하려는 마커를 클릭해 정보조회창을 열어주세요.</li>
                        <li>하단의 삭제 버튼을 눌러주세요.</li>
                        <li>마커를 추가할 때 입력한 비밀번호를 입력해주세요.</li>
                    </ol>
                </ul>

                <br><h3>마커 검색</h3><br>
                <ul>
                    <li>특정 마커를 검색하는 방법</li>
                    <ol>
                        <li>상단바의 검색을 누른 후, 검색하려는 단어를 입력하고 검색 버튼을 눌러주세요.</li>
                        <li>검색결과를 초기화 하려면, 검색창에서 초기화를 누르거나 상단바의 모두 표시를 눌러주세요.</li>
                        <li>지도위에 검색된 마커만 표시됩니다.</li>
                    </ol>
                </ul>

                <br><h3>마커의 유지 기간</h3><br>
                <ul>
                    <li>자료 보관 기간 안내</li>
                    <ul>
                        <li>한번 등록된 정보는 사용자가 직접 삭제하지 않는한 약 72시간 동안 유지 됩니다.</li>
                        <li>한번 등록된 정보는 추후 빅데이터 분석을 통해 근본적인 실종사고 원인을 해결하는 등의 목적으로 보관되고 활용될 수 있습니다.</li>
                    </ul>
                </ul>

                <p>아래의 확인 버튼을 클릭하면 7일간 초기 화면이 표시되지 않습니다. 다시 확인하려면 상단메뉴바에서 '사용설명'을 확인해주세요.</p>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <input type="checkbox" id="agree-cb">위의 내용을 모두 이해하였습니다.
                <button type="button" class="btn btn-secondary" onclick="agree()">확인</button>
            </div>

        </div>
    </div>
</div>

<!-- INSERT MODAL -->
<div class="modal fade" id="insertModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">새로운 마커 추가</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <!-- Modal body -->
            <form target="preventRedirect">
                <div class="modal-body">
                    <div class="form-group">
                        <div class="custom-file mb-3">
                            <label class="custom-file-label" for="img-file">발견한 사진을 추가해주세요</label>
                            <input type="file"
                                   class="custom-file-input"
                                   id="img-file"
                                   name="filename"
                                   accept="image/*"
                                   required="true" />
                        </div>

                        <label for="comment">추가 설명</label>
                        <textarea class="form-control" rows="5" id="comment" placeholder="반려동물 상태나 특징들을 설명해주세요! 검색에 더 잘 노출 될 수 있도록 해시테그 부탁 드립니다. 예시 #포메리안 #공원 #강아지 등등" required></textarea>

                        <br>

                        <label for="marker-type">마커 유형</label>
                        <select class="form-control" id="marker-type">
                            <option value='finding' selected>제 반려동물좀 찾아주세요..</option>
                            <option value='found'>주인을 잃어버린거 같아요.!</option>
                        </select>

                        <br>

                        <label for="datetimepicker1">실종/발견 시간</label>
                        <div class='input-group date' id='datetimepicker1' data-target-input="nearest">
                            <input type='text'
                                   class="form-control"
                                   id="f_time"
                                   inputmode="none"
                                   placeholder="실종/발견한 날짜와 시간을 선택해주세요!"
                                   data-target="#datetimepicker1"
                                   readonly
                            />
                            <span class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
	              	<div class="input-group-text"><span class="fa fa-calendar"></span></div>
	              </span>
                        </div>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <p id="auto-close" style="visibility: hidden;">완료시 창이 자동으로 닫칩니다.</p>
                    <input type="submit" id="btn-add" class="btn btn-info" onclick="addNewMarker()" value="추가">
                    <button type="button" id="btn-add-close" class="btn btn-danger" data-dismiss="modal">닫기</button>
                </div>
            </form>

        </div>
    </div>
</div>
<iframe id="if" name="preventRedirect"></iframe>
<script>

  $(function () {
    $('#datetimepicker1').datetimepicker({
      locale: 'ko',
      format: 'YYYY-MM-DD HH:mm',
      ignoreReadonly: true,
      //sideBySide: true
    });
  });

  $(".custom-file-input").on("change", function() {
    var fileName = $(this).val().split("\\").pop()
    $(this).siblings(".custom-file-label").addClass("selected").html(fileName)
  })
</script>

<!-- SEARCH -->
<div class="modal fade" id="search-modal">
    <form>
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">검색</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="form-group">
                        <label for="search-word">검색어</label>
                        <input type="text" class="form-control" id="search-word" autofocus>
                    </div>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    <!--<button type="button" class="btn btn-info" data-dismiss="modal" onclick="addNewMarker()">추가</button>-->
                    <button type="button" class="btn" data-dismiss="modal" onclick="markerSwitch('all')">초기화</button>
                    <input type="submit" class="btn btn-success" data-dismiss="modal" onclick="searchMarker()" value="검색">
                    <!--<button type="button" class="btn btn-success" data-dismiss="modal" onclick="searchMarker()">검색</button>-->
                    <button type="button" class="btn btn-danger" data-dismiss="modal">닫기</button>
                </div>

            </div>
        </div>
    </form>
</div>

<!-- INFO -->
<input type="hidden" id="m_id" value="" />
<div class="modal fade" id="infoModal">
    <form>
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title" id="info-type">타입 정보 여기 표시</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body" id="info-body">
                    <div>
                        <img id="info-img" alt="사진">
                    </div>
                    <pre id="info-comment">관련 Comment가 여기에 표시됩니다.</pre>
                    <p id="info-f-time" style="font-size: 14px; position: absolute; right: 10px; bottom: -5px;">실종/발견 시간</p>
                </div>

                <!-- Modal footer -->
                <div class="modal-footer">

                    <button type="button" class="btn" data-dismiss="modal" onclick="deleteMarker()">삭제</button>
                    <button type="button" class="btn btn-danger" data-dismiss="modal">닫기</button>
                </div>

            </div>
        </div>
    </form>
</div>

<!-- To use data from anywehre -->
<input type="hidden" id="mouseLat" value=""/>
<input type="hidden" id="mouseLng" value=""/>

<input type="hidden" id="site_url" value="<%= process.env.SITE_URL %>">
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=dd7cc743403ed91289c131f3f48d89be"></script>
<script type="text/javascript" src="/js/markers.js"></script>

</body>
</html>
